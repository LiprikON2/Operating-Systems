# Лабораторная 5
> Рейнгеверц - K33401

Установленно
```bash
yum install bzip2
yum install at
```

- Использовался CentOS


### Задание 1
> Объясните “странные” результаты сжатия файлов floppyZero и floppyRandom
> 

Все алгоритмы сжатия работают на принципе нахождения и сокращение повторяющихся, похожих данных

В первом случае, floppyZero наполнен нулями, и чтобы полностью описать такой файл достаточно сказать: "ноль, дублированный 1 500 000 раз" 

Во втором случае, отсутствие какой либо закономерности в floppyRandom не позволяет сократить запись, и нужно полностью указать все его "байты"



### Задание 2
> Покажите разницу в степени сжатия между утилитами gzip с уровнями сжатия 1, 6 и 9 (степень сжатия задается опцией -N, где N число от 1 до 9, указывающее степень сжатия) и bzip2 на примере файла, созданного командой: 
> 
> `man man > heManFile`

Создание

![](https://i.imgur.com/XKRAn1G.png)

Сжатие 1, 6, 9 уровней через gzip 

![](https://i.imgur.com/s6VDYc9.png)
Сжатие достигло максимума на 6 уровне и сократило размер файла в 3 раза


Сжатие 1, 6, 9 уровней через bzip2 

![1QfjCs1.png](https://i.imgur.com/1QfjCs1.png)
Сжатие достигло максимума на 1 уровне и так же сократило размер файла в 3 раза

### Задание 3
> Попробуйте сжать картинку в формате png (jpeg) утилитой gzip используя различные уровни сжатия от 1 до 9. 
> - На сколько процентов от исходного размера
был сжат файл? 
> - Сильно ли отличается степень сжатия между уровнями? Почему?


Сжимаем `kitty.jpg`
![SWni8Hz.png](https://i.imgur.com/SWni8Hz.png)

В результате сжатие через gzip никак не сократило размер файла. 

В jpg уже присутствует алгоритм сжатия и дополнительно сжимать изображения имеет мало смысла. Все повторяющиеся данные уже были "сокращены" и мы попадаем в ситуацию где пытаемся "сократить" набор из случайных значений, что маловозможно.  


### Задание 4

> Как было сказано, tar не умеет самостоятельно сжимать данные, но tar можно сообщить о том, что для сжатия данных следует использовать одну из утилит, например, gzip/bzip2. 
> 
> Замените опции при создании/распаковке архива -cf/-xf на -czf/-xzf (для использования gzip) или на -cjz/-xjf (для использования bzip2), после чего сравните размеры архивов с сжатием и без сжатия данных.
> 

![AhsyqQf.png](https://i.imgur.com/AhsyqQf.png)

Архивировние через gzip и bzip2 показало идентичные результаты


### Задание 5
> Напишите bash сценарий для создания инкрементных бэкапов. 
> 
> - Воспользуйтесь теми же командами, что приведены для разностных бэкапов
> 
> - Hint: Обратите внимание на шаг 2.

На основе incremental и differential бекапов стоит изначальный full бекап. 

Разница между incremental и differential бекапами состоит в том, что когда каждый differential бекап ссылается ссылается на изначальный full бекап, то incremental бекап всегда ссылкатеся на предыдущий incremental бекап (если таких нет то уже только тогда ссылается на full бекап)

Тогда, для того, чтобы реализовать incremental бекап, в приведенном [diff_backup.sh](backup/diff_backup.sh) достаточно изменить и продублировать второй шаг между каждым incremental бекапом. В результате, в [inc_backup.sh](backup/inc_backup.sh) каждый incremental бекап ссылается на предыдущий, а не на самый первый full бекап

### Задание 6
> Для разового выполнения заданий существует команда at.
> - Используя эту команду, запланируйте разовое выполнение полного бэкапа.

[At Command in Linux \| Linuxize](https://linuxize.com/post/at-command-in-linux/)

Включение at daemon
```bash
systemctl enable --now atd
```

Запустить скрипт full_backup.sh в 11:17, не отправляя писем
```bash
at 11:17 -M -f full_backup.sh
```

Результат

![](https://i.imgur.com/qSvadzk.png)



### Задание 7
> Используя cron и сценарий из предыдущей части, запланируйте выполнение разностных или инкрементных бэкапов. 
> 
> Hints: 
> - За дополнительной информацией по демону cron, настройке crontab или команде at обращайтесь к соответствующим страницам справочного рукодоства man cron, man crontab или man at. 
> 
> - Также про cron и команду at можно поподробнее почитать на сайте [IBM](http://www.ibm.com/developerworks/ru/library/l-job-scheduling/) 
> 

Тестовое, ежеминутное правило для crontab ― работает
![ZSf1Hvu.png](https://i.imgur.com/ZSf1Hvu.png)



Добавление скрипта для инкрементального бекапа
```bash
crontab -e
```

![](https://i.imgur.com/dFzXqii.png)


С помощью [crontab.guru](https://crontab.guru/) можно легче подобрать временное правило

Например, таким образом можно запускать скрипт каждый понедельник, среду и пятницу
`00 00 * * 1,3,5 sh /root/lab5/backup/inc_backup.sh`
![](https://i.imgur.com/EcAARsh.png)



Ждем минуту


Проверяем почту

![](https://i.imgur.com/vS8d5Qp.png)


Видим что скрипт отработал

![](https://i.imgur.com/5IEr6lu.png)